# TCP/HTTP与django-url

## 1.OSI七层模型

### 1.1概述:

互联网的本质就是**一系列的网络协议**，OSI（Open System Interconnect），即开放式系统互联。 一般都叫OSI参考模型，是ISO（国际标准化组织）组织在1985年研究的网络互连模型。ISO为了更好的使网络应用更为普及，推出了OSI参考模型。其含义就是推荐所有公司使用这个规范来控制网络。这样所有公司都有相同的规范，就能互联了。

### 1.2OSI模型划分

**七层**划分为：**应用层、表示层、会话层、传输层、网络层、数据链路层、物理层**。

**五层**划分为：**应用层、传输层、网络层、数据链路层、物理层**。

**四层**划分为：**应用层、传输层、网络层、网络接口层**。

`表示关系如下图:`

![](images\OSI模型示意图.png)

### 1.3模型层讲解与作用

七层模型为例了解每层的作用:

**应用层**

OSI参考模型中最靠近用户的一层，是为计算机用户提供应用接口，也为用户直接提供各种网络服务。我们常见应用层的网络服务协议有：HTTP，HTTPS，FTP，POP3、SMTP等。

**表示层**

表示层提供各种用于应用层数据的编码和转换功能,确保一个系统的应用层发送的数据能被另一个系统的应用层识别。如果必要，该层可提供一种标准表示形式，用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。数据压缩和加密也是表示层可提供的转换功能之一。

**会话层**

会话层就是负责建立、管理和终止表示层实体之间的通信会话。该层的通信由不同设备中的应用程序之间的服务请求和响应组成。

**传输层**

传输层建立了主机端到端的链接，传输层的作用是为上层协议提供端到端的可靠和透明的数据传输服务，包括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信的细节，使高层用户看到的只是在两个传输实体间的一条主机到主机的、可由用户控制和设定的、可靠的数据通路。

**网络层**

本层通过IP寻址来建立两个节点之间的连接，为源端的运输层送来的分组，选择合适的路由和交换节点，正确无误地按照地址传送给目的端的运输层。就是通常说的IP层。这一层就是我们经常说的IP协议层。IP协议是Internet的基础。

**数据链路层**

将比特组合成字节,再将字节组合成帧,使用链路层地址 (以太网使用MAC地址)来访问介质,并进行差错检测。

数据链路层又分为2个子层：逻辑链路控制子层（LLC）和媒体访问控制子层（MAC）。

MAC子层处理CSMA/CD算法、数据出错校验、成帧等；LLC子层定义了一些字段使上次协议能共享数据链路层。 在实际使用中，LLC子层并非必需的。

**物理层**

实际最终信号的传输是通过物理层实现的。通过物理介质传输比特流。规定了电平、速度和电缆针脚。常用设备有（各种物理设备）集线器、中继器、调制解调器、网线、双绞线、同轴电缆。这些都是物理层的传输介质。

## 2.网络协议:

### 2.1概述:

网络协议是一组在许多独立主机系统之间提供互联功能的协议，规范因特网上所有计算机互联时的传输、解释、执行、互操作，解决计算机系统的互联、互通、操作性，是被公认的网络通信协议的国际工业标准。

TCP/IP(Transmission Control Protocol/Internet Protocol)作为Internet的核心协议。它是个协议族，包含多种协议.
分层的基本想法是每一层都在它的下层提供的服务基础上提供更高级的增值服务,而最高层提供能运行分布式应用程序的服务.

![](images\网络协议.jpg)

发送请求的过程是从最顶层（应用层）出发，每一层负责封装属于自己的信息到请求中，最后将一整个请求发送给对方。
接收请求的过程是从最底层（网络接口层）开始，每一层的协议负责解析属于自己的东西，比如网际层（IP）处理ip信息，传输层（TCP）处理点对点的端口，应用层（HTTP）处理Request或Response的Line\Header\Body。

## 3.TCP概念

### 3.1概述:

TCP是一种面向连接（连接导向）的、可靠的基于字节流的传输层通信协议。TCP将用户数据打包成报文段，它发送后启动一个定时器，另一端收到的数据进行确认、对失序的数据重新排序、丢弃重复数据。

### 3.2特点:

- TCP是面向连接的运输层协议
- 每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的
- TCP提供可靠交付的服务
- TCP提供全双工通信。数据在两个方向上独立的进行传输。因此，连接的每一端必须保持每个方向上的传输数据序号。

### 3.3TCP首部格式

![](images\TCP首部.webp)

（1）   Source Port（源端口号）：数据发起者的端口号，16bit。
（2）   Destination Port（目的端口号）：数据接收者的端口号，16bit。
（3）   Sequence Number（顺序号码，Seq）：用于在数据通信中解决网络包乱序（reordering）问题，以保证应用层接收到的数据不会因为网络上的传输问题而乱序（TCP会用这个顺序号码来拼接数据），32bit。
（4）   Acknowledgment Number（确认号码，ack）：是数据接收方期望收到发送方在下一个报文段的顺序号码（Seq），因此确认号码应当是上次已成功收到顺序号码（Seq）加1，32bit。
（5）   TCP Flags（TCP标志位）每个长度均为1bit
          CWR：压缩，TCP Flags值0x80。
          ECE：拥塞，0x40。
          URG：紧急，0x20。当URG=1时，表示报文段中有紧急数据，应尽快传送。
          ACK：确认，0x10。当ACK = 1时，代表这是一个确认的TCP包，取值0则不是确认包。
          PSH：推送，0x08。当发送端PSH=1时，接收端尽快的交付给应用进程。
          RST：复位，0x04。当RST=1时，表明TCP连接中出现严重差错，必须释放连接，再重新建立连接。
          SYN：同步，0x02。在建立连接是用来同步序号。SYN=1， ACK=0表示一个连接请求报文段。SYN=1，ACK=1表示同意建立连接。
          FIN：终止，0x01。当FIN=1时，表明此报文段的发送端的数据已经发送完毕，并要求释放传输连接。

### 3.4三次握手与四次挥手

**三次握手**

 第一次握手是客户端向服务器发送连接标志变量表示请求连接
 第二次握手代表服务器收到请求后,回复变量标志确认可连接
 第三次握手客户端收到回复,发送最终连接标志建立连接

![](images\三次握手示意图.png)

**第一次握手：**

> 客户端向服务端发送**连接请求**报文段。该报文段的头部中**SYN=1**，**ACK=0**，同时选择一个初始序号**seq=N**。请求发送后，客户端便进入**SYN-SENT**状态。

**第二次握手：**

> 服务端收到连接请求报文段后，如果同意连接，会发送一个应答：**SYN=1，ACK=1，seq=S，ack=N+1**。发送完应答后服务端进入**SYN-RCVD**状态。

**第三次握手：**

> 客户端收到服务端连接同意的应答后，还会向服务端发送一个确认报文段，表示：服务端发来的连接同意应答已经成功收到。该报文段的头部为：**ACK=1，ack=S+1**。该报文发送完毕后，客户端和服务器端都进入**ESTABLISHED**状态，完成**TCP三次握手**



**四次挥手**

第一次挥手主动方发送标志表示请求断开连接
第二次挥手被动方收到请求后立即返回信息表示已经接到请求
第三次挥手被动方消息处理完毕再次发送标志表示已经准备好可以断开
第四次挥手主动方收到被动方消息,发送最终断开标识,连接断开

![](images\四次挥手.png)

**第一次挥手**

> 客户端数据发送完成，则它向服务端发送连接释放请求。该请求只有报文头，头中携带的主要参数为：**FIN=M**。此时，客户端将进入**FIN-WAIT-1**状态。TCP规定，**FIN报文段**即使不携带数据，也要消耗一个序号。

**第二次挥手**

> Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。

**第三次挥手**

> Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。

**第四次挥手**

> Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。

![](images\简洁版三次握手.jpg)



## 4.HTTP概念

### 4.1HTTP概述:

HTTP是一个应用层协议，虽然在2015年已推出HTTP/2版本，并被主要的web浏览器和web服务器支持。但目前使用最广泛的还是HTTP/1.1版本。

### 4.2HTTP特点:

- 支持客户/服务器模式。
- 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。由于HTTP协议简单，使得HTTP服务器的程序规模小，因而通信速度很快。
- 灵活：HTTP允许传输任意类型的数据对象。正在传输的类型由Content-Type加以标记。
- 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。
- 无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。为了解决这个问题， Web程序引入了Cookie机制来维护状态。

- HTTP请求报文和响应报文都是由开始行（对于请求消息，开始行就是请求行，对于响应消息，开始行就是状态行），消息报头（可选），空行（只有CRLF的行），消息正文（可选）组成。

### 4.3请求报文结构:

![](images\请求报结构.png)

### 4.4请求报示例:

```shell
POST /search HTTP/1.1  

Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms-excel, application/vnd.ms-powerpoint, 
application/msword, application/x-silverlight, application/x-shockwave-flash, */*  
Referer: http://www.google.cn/  
Accept-Language: zh-cn  
Accept-Encoding: gzip, deflate  
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; TheWorld)  
Host: www.google.cn 
Connection: Keep-Alive  
Cookie: PREF=ID=80a06da87be9ae3c:U=f7167333e2c3b714:NW=1:TM=1261551909:LM=1261551917:S=ybYcq2wpfefs4V9g; 
NID=31=ojj8d-IygaEtSxLgaJmqSjVhCspkviJrB6omjamNrSm8lZhKy_yMfO2M4QMRKcH1g0iQv9u-2hfBW7bUFwVh7pGaRUb0RnHcJU37y-
FxlRugatx63JLv7CWMD6UB_O_r  
hl=zh-CN&source=hp&q=domety 

```

### 4.5请求报文-请求方法

```shell 
GET             请求指定的页面信息，并返回实体主体。
POST            向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST 				  请求可能会导致新的资源的建立和/或已有资源的修改。
HEAD            类似于 GET 请求，只不过返回的响应中没有具体的内容，用于获取报头
PUT             从客户端向服务器传送的数据取代指定的文档的内容。
DELETE          请求服务器删除指定的页面。
CONNECT         HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。
TRACE           回显服务器收到的请求，主要用于测试或诊断。
OPTIONS         允许客户端查看服务器的性能。
PATCH			是对 PUT 方法的补充，用来对已知资源进行局部更新 。
```
### 4.6响应报文结构

![](images\响应包结构.png)

### 4.7响应报示例:

```shell
HTTP/1.1 200 OK

Date: Mon, 23 May 2005 22:38:34 GMT
Content-Type: text/html; charset=UTF-8
Content-Encoding: UTF-8
Content-Length: 138
Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
Server: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)
ETag: "3f80f-1b6-3e1cb03b"
Accept-Ranges: bytes
Connection: close

<html>
<head>
  <title>An Example Page</title>
</head>
<body>
  Hello World, this is a very simple HTML document.
</body>
</html>
```

### 4.8响应报文-响应码

**说明:**

状态代码由三位数字组成，第一个数字定义了响应的类别，且有五种可能取值。
1xx：指示信息--表示请求已接收，继续处理。
2xx：成功--表示请求已被成功接收、理解、接受。
3xx：重定向--要完成请求必须进行更进一步的操作。
4xx：客户端错误--请求有语法错误或请求无法实现。
5xx：服务器端错误--服务器未能实现合法的请求。

**常用状态码:**

200 OK：成功返回状态，对应，GET,PUT,PATCH,DELETE。
201 created  - 成功创建。
302 Found：重定向，新的URL会在response中的Location中返回，浏览器将会使用新的URL发出新的Request。
304 Not Modified：代表上次的文档已经被缓存了， 还可以继续使用。
400 bad request   - 请求格式错误。
401 unauthorized   - 未授权。
403 forbidden   - 鉴权成功，但是该用户没有权限。
404 not found - 请求的资源不存在。
405 method not allowed - 该http方法不被允许。
410 gone - 这个url对应的资源现在不可用。
415 unsupported media type - 请求类型错误。
422 unprocessable entity - 校验错误时用。
429 too many request - 请求过多。
500 Internal Server Error：服务器发生了不可预期的错误。
503 Server Unavailable：服务器当前不能处理客户端的请求，一段时间后可能恢复正常。

### 4.9HTTP头域-常用头

**见Excel表 http头域.xlsx ---路径：day01(2020-5-6)-tpc、http与django-url\doc\http头域.xlsx**

## 5.TCP与HTTP

- Http和Tcp是两种不同的协议，TCP是传输层http是应用层。http是要基于TCP连接基础上的（应用实例)，简单的说，TCP就是单纯建立连接，不涉及任何我们需要请求的实际数据，简单的传输。http是用来收发数据，即实际应用上来的。
-  TCP是底层通讯协议，定义的是数据传输和连接方式的规范, HTTP是应用层协议，定义的是传输数据的内容的规范
- HTTP协议中的数据是利用TCP协议传输的，所以支持HTTP也就一定支持TCP     
- HTTP支持的是www服务,TCP/IP是协议是Internet国际互联网络的基础。TCP/IP是网络中使用的基本的通信协议。TCP/IP实际上是一组协议，它包括上百个各种功能的协议.通常说TCP/IP是Internet协议族，而不单单是TCP和IP。

## 6.django-url练习题:

请实现当url是http://127.0.0.1:8000/sum/n/（n是数字且不大于1000）时，返回的页面显示1~n的累加和的结果。(1~n累加即1+2+3+...+n)

